<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoParts - Catálogo</title>
    <link rel="stylesheet" href="/css/client.css">
</head>
<body>

    <%- include('partials/nav') %>

    <main>
        <div class="section-header" style="margin-bottom: 2rem; background: none; padding-left: 0;">
            <h1 style="margin: 0;">Catálogo de Productos (Admin)</h1>
        </div>

        <% if (productos && productos.length > 0) { %>
            <div class="grid">
                <% productos.forEach(prod => { %>
                    <div class="card">
                        <img src="<%= prod.imagen %>" alt="<%= prod.nombre %>" onerror="this.src='https://via.placeholder.com/200?text=Sin+Imagen'">
                        <h4><%= prod.nombre %></h4>
                        <p>$<%= prod.precio %></p>
                        <p>Activo: <%= prod.activo %></p>
                        <div class="controls" style="margin-top: 10px;">
                            <a href="/modificar?id=<%= prod.id %>" class="btn-link">Editar</a>
                            <% if (prod.activo == 1) { %>
                                <button type="button" onclick="deleteProduct(<%= prod.id %>)">Eliminar</button>
                            <% } else { %>
                                <button type="button" onclick="activateProduct(<%= prod.id %>)" style="background: green; color: white;">Reactivar</button>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <p>No hay productos cargados.</p>
        <% } %>
    </main>

    <script>
        async function deleteProduct(id) {
            if (!confirm("¿Eliminar producto?")) return;
            const res = await fetch(`/api/products/${id}`, { method: "DELETE" });
            if (res.ok) {
                window.location.reload();
            }
        }
        async function activateProduct(id) {
            if (!confirm("¿Reactivar producto?")) return;
            const res = await fetch(`/api/products/${id}/activate`, { method: "PUT" });
            if (res.ok) {
                window.location.reload();
            }
        }
    </script>

</body>
</html>
